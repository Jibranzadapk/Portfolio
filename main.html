<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Quicksand';
            background-color: #000;
            color: #3CFF15;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .section-page {
            width: 100%;
            max-width: 900px;
            padding: 20px;
        }
        .plus-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #000;
            border: 3px solid #3CFF15;
            color: #3CFF15;
            font-size: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            z-index: 1100;
        }
        .plus-btn:hover {
            box-shadow: 0 0 15px #3CFF15;
        }
        .plus-btn.rotate {
            transform: rotate(45deg);
        }
        .popupblog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(0, 0, 0, 0.75);
            border: 3px solid #3CFF15;
            backdrop-filter: blur(8px);
            padding: 20px;
            border-radius: 12px;
            display: none;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 380px;
            z-index: 1000;
            transition: all 0.2s ease;
            grid-auto-rows: minmax(40px, auto);
            justify-items: center;
            max-height: 80vh;
            overflow: auto;
        }
        .popupblog.show {
            display: grid;
            transform: translate(-50%, -50%) scale(1);
        }
        .popupblog button {
            background-color: transparent;
            color: #3CFF15;
            width: 110px;
            border: 2.5px solid #3CFF15;
            padding: 8px 10px;
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .popupblog button:hover,
        .popupblog button:focus {
            background-color: #3CFF15;
            color: #000;
        }
        .content-block {
            background-color: #000;
            border: 3px solid #3CFF15;
            border-radius: 6px;
            margin: 12px 0;
            padding: 10px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 8px;
            animation: fadeIn 0.3s ease;
            width: 100%;
            box-sizing: border-box;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .delete-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            background-color: red;
            color: #000;
            font-weight: bold;
            font-size: 0.9rem;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            width: 28px;
            height: 28px;
            line-height: 1;
        }
        .delete-btn:hover {
            filter: brightness(1.3);
        }
        .content-block textarea {
            background-color: transparent;
            color: #3CFF15;
            border: none;
            resize: none;
            outline: none;
            font-size: 16px;
            line-height: 1.4;
            width: 100%;
            box-sizing: border-box;
        }
        .italic-textarea {
            font-style: italic;
        }
        .content-block img,
        .content-block video,
        .content-block audio {
            width: 100%;
            max-height: 500px;
            border-radius: 4px;
        }
        .media-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        .media-container button {
            border: 2px solid #3CFF15;
            background: transparent;
            color: #3CFF15;
            padding: 6px 10px;
            border-radius: 16px;
            cursor: pointer;
            font-size: 0.85rem;
        }
        .media-container button:hover {
            background: #3CFF15;
            color: #000;
        }
        .media-container .upload-image, .media-container .link-image, .media-container .upload-video, .media-container .link-video, .media-container .upload-audio{
            border: 3px solid #3CFF15;
            font-size: 1.2rem;
            border-radius: 25px;
            padding: 4px 20px;
        }
        .dynamic-config-btn {
            border: 3px solid #3CFF15;
            background: transparent;
            color: #3CFF15;
            padding: 6px 20px;
            font-weight: 800;
            border-radius: 20px;
            font-size: 1rem;
            cursor: pointer;
            width: fit-content;
            margin: 0 auto;
        }
        .dynamic-config-btn:hover {
            background: #3CFF15;
            color: #000;
        }
        .list-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .list-controls button {
            border: 3px solid #3CFF15;
            background: transparent;
            color: #3CFF15;
            padding: 6px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 800;
            margin: 0 auto;
        }
        .list-controls button:hover { background: #3CFF15; color: #000; }
        .editable-list {
            width: 100%;
            padding-left: 20px;
            box-sizing: border-box;
        }
        .editable-list li {
            padding: 4px 0;
            outline: none;
        }
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .modal-overlay.show {
            display: flex;
        }
        .modal {
            background: #000;
            border: 3px solid #3CFF15;
            padding: 14px;
            border-radius: 10px;
            width: 320px;
            box-sizing: border-box;
            color: #3CFF15;
        }
        .modal label { display:block; margin-top:6px; font-size:0.9rem; }
        .modal input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-top:6px;
            background: transparent;
            border: 1.5px solid #3CFF15;
            color: #3CFF15;
            border-radius: 8px;
            box-sizing: border-box;
        }
        .modal .actions { display:flex; gap:8px; justify-content:flex-end; margin-top:10px; }
        .modal .actions button {
            border:2px solid #3CFF15;
            background: transparent;
            color:#3CFF15;
            padding:6px 10px;
            border-radius:8px;
            cursor:pointer;
        }
        .modal .actions button:hover { background:#3CFF15; color:#000; }
        @media (max-width: 700px) {
            .popupblog { width: 92%; grid-template-columns: repeat(2, 1fr); }
            .content-block { width: 94%; }
        }
         .content-block .title{
            font-size:2rem;
            font-weight: bold;
        }
        .content-block .heading{
            font-size: 1.5rem;
            font-weight: 800;
        }
        .content-block .heading-two{
            font-size: 1rem;
            font-weight: 800;
        }
        .content-block .heading-three{
            font-size: 0.8rem;
            font-weight: 800;
        }
        .content-block .paragraph, .link, list-area, .italic-textarea{
            font-size: 1rem;
        }
        .content-block .link{
            text-decoration: underline;
            font-weight: 800;
        }
        .save-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #000;
            border: 3px solid #3CFF15;
            color: #3CFF15;
            font-size: 1rem;
            padding: 6px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.3s ease;
            z-index: 1100;
        }
        .save-btn:hover {
            background-color: #3CFF15;
            color: #000;
            box-shadow: 0 0 10px #3CFF15;
        }
        .save-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.75);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }
        .save-modal-overlay.show {
            display: flex;
        }
        .save-modal {
            width: 720px;
            max-width: 96%;
            background: linear-gradient(180deg, rgba(0,0,0,0.95), rgba(5,5,5,0.98));
            border: 3px solid #3CFF15;
            border-radius: 12px;
            padding: 20px;
            box-sizing: border-box;
            color: #3CFF15;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            overflow: hidden;
            position: relative;
        }
        .save-modal .header {
            display:flex;
            justify-content:space-between;
            align-items:center;
            gap:12px;
        }
        .save-modal h2 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 800;
        }
        .save-modal .close-save {
            background: transparent;
            border: 3px solid #3CFF15;
            color: #3CFF15;
            font-weight: 800;
            border-radius: 30px;
            font-size: 15px;
            padding: 6px 8px;
            cursor: pointer;
        }
        .save-modal .close-save:hover { background:#3CFF15; color:#000; }
        .save-stages {
            position: relative;
            height: 420px;
            margin-top: 16px;
            overflow: hidden;
        }
        .save-stage {
            position: absolute;
            inset: 0;
            padding: 12px;
            box-sizing: border-box;
            transition: transform 280ms cubic-bezier(.2,.9,.3,1), opacity 220ms ease;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .save-stage.hidden { opacity:0; pointer-events:none; transform: translateX(30px); }
        .save-stage.active { opacity:1; pointer-events:auto; transform: translateX(0); }
        .field-row {
            display:flex;
            flex-direction:column;
            gap:6px;
        }
        label {
            font-size:0.9rem;
            font-weight:700;
        }
        input[type="text"], input[type="password"], textarea {
            background: transparent;
            border: 1.5px solid #3CFF15;
            color: #3CFF15;
            padding: 8px 10px;
            border-radius: 8px;
            font-size: 0.95rem;
            outline: none;
            box-sizing: border-box;
        }
        textarea { min-height: 90px; resize:vertical; }
        .center-actions {
            display:flex;
            justify-content:center;
            gap:10px;
            margin-top: auto;
        }
        .btn {
            border: 2.5px solid #3CFF15;
            background: transparent;
            color: #3CFF15;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight:700;
            cursor: pointer;
        }
        .btn:hover { background: #3CFF15; color:#000; }
        .btn.secondary {
            border-style:dashed;
            font-weight:600;
        }
        .author-card {
            display:flex;
            gap:12px;
            align-items:center;
            padding: 10px;
            border-radius: 10px;
            border: 1.5px solid rgba(60,255,21,0.12);
            background: rgba(60,255,21,0.02);
        }
        .author-photo {
            width:64px;
            height:64px;
            border-radius:50%;
            background: linear-gradient(180deg, #222, #111);
            display:flex;
            align-items:center;
            justify-content:center;
            font-weight:800;
            border: 2px solid #3CFF15;
            overflow:hidden;
        }
        .author-photo img { width:100%; height:100%; object-fit:cover; display:block; }
        .author-meta .name { font-weight:800; font-size:1rem; }
        .author-meta .bio { font-size:0.85rem; color: rgba(63,255,33,0.9); }
        .error {
            color: #ff7575;
            font-size: 0.9rem;
            margin-top:6px;
        }
        @media (max-width: 520px) {
            .save-modal { padding: 12px; }
            .save-stages { height: 420px; }
        }
        
        /* Export progress indicator */
        .export-progress {
            display: none;
            align-items: center;
            gap: 8px;
            color: #3CFF15;
            font-size: 0.9rem;
        }
        .export-progress.show {
            display: flex;
        }
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid #3CFF15;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Security indicator */
        .security-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: #7fffa5;
            margin-top: 4px;
        }
        .security-icon {
            color: #3CFF15;
        }
    </style>
</head>
<body>
<section id="blog-section" class="section-page">
<button class="save-btn" id="save-btn">Save</button>
    <button class="plus-btn" id="plus-btn">
        <i class="fa-solid fa-plus"></i>
    </button>
    <div class="popupblog" id="popupblog">
        <button data-type="title">Title</button>
        <button data-type="heading">Heading</button>
        <button data-type="paragraph">Paragraph</button>
        <button data-type="heading2">Heading 2</button>
        <button data-type="heading3">Heading 3</button>
        <button data-type="link">Link</button>
        <button data-type="audio">Audio</button>
        <button data-type="image">Image</button>
        <button data-type="video">Video</button>
        <button data-type="customButton">Button</button>
        <button data-type="listblock">List</button>
        <button data-type="italic">Italic</button>
    </div>
    <template id="template-title">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <textarea placeholder="Enter Title" class="title"></textarea>
        </div>
    </template>
    <template id="template-heading">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <textarea placeholder="Enter Heading" class="heading"></textarea>
        </div>
    </template>
    <template id="template-paragraph">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <textarea placeholder="Enter Paragraph" class="paragraph"></textarea>
        </div>
    </template>
    <template id="template-heading2">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <textarea placeholder="Enter Heading 2" class="heading-two"></textarea>
        </div>
    </template>
    <template id="template-heading3">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <textarea placeholder="Enter Heading 3" class="heading-three"></textarea>
        </div>
    </template>
    <template id="template-link">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <textarea placeholder="Enter Link" class="link"></textarea>
        </div>
    </template>
    <template id="template-audio">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <div class="media-container">
                <button class="upload-audio">Upload</button>
                <audio controls></audio>
            </div>
        </div>
    </template>
    <template id="template-image">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <div class="media-container">
                <!-- <button class="upload-image">Upload</button> -->
                <button class="link-image">Link</button>
            </div>
        </div>
    </template>
    <template id="template-video">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <div class="media-container">
                <!-- <button class="upload-video">Upload</button> -->
                <button class="link-video">Link</button>
            </div>
        </div>
    </template>
    <template id="template-customButton">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <div style="display:flex; align-items:center; gap:10px;">
                <button class="dynamic-config-btn">+Add</button>
            </div>
        </div>
    </template>
    <template id="template-listblock">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <div class="list-controls">
                <button class="count-list-btn">Counting list</button>
                <button class="bullet-list-btn">Bullet point list</button>
            </div>
            <div class="list-area"></div>
        </div>
    </template>
    <template id="template-italic">
        <div class="content-block">
            <button class="delete-btn">X</button>
            <textarea class="italic-textarea" placeholder="Enter italic text"></textarea>
        </div>
    </template>
</section>
<div class="modal-overlay" id="modalOverlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
        <div id="modalTitle" style="font-weight:700; margin-bottom:6px;">Configure Button</div>
        <label for="modalName">Name</label>
        <input type="text" id="modalName" placeholder="Button name (text shown)"/>
        <label for="modalLink">Link (URL)</label>
        <input type="text" id="modalLink" placeholder="https://example.com"/>
        <div style="margin-top:8px; font-size:0.85rem; color:#7fffa5;">Leave link empty to keep the button non-navigating.</div>
        <div class="actions" style="margin-top:12px;">
            <button id="modalCancel">Cancel</button>
            <button id="modalSave">Save</button>
        </div>
    </div>
</div>
<div class="save-modal-overlay" id="saveModalOverlay" role="dialog" aria-modal="true" aria-labelledby="saveModalTitle" aria-hidden="true">
    <div class="save-modal" role="document" aria-label="Save Blog Dialog">
        <div class="header">
            <h2 id="saveModalTitle">Blog Details</h2>
            <div style="display:flex; gap:8px; align-items:center;">
                <button class="close-save" id="saveModalCancel" title="Close">✕</button>
            </div>
        </div>
        <div class="save-stages" id="saveStages">
            <div class="save-stage active" data-stage="1" id="stage1">
                <div class="field-row">
                    <label for="saveTitle">Title</label>
                    <input id="saveTitle" type="text" placeholder="Enter blog title" />
                </div>
                <div class="field-row">
                    <label for="saveKeywords">Keywords (comma separated)</label>
                    <input id="saveKeywords" type="text" placeholder="keyword1, keyword2, ..." />
                </div>
                <div class="field-row">
                    <label for="saveDescription">Description</label>
                    <textarea id="saveDescription" placeholder="Short description of the blog"></textarea>
                </div>
                <div class="field-row">
                    <label for="saveRobots">Robots</label>
                    <input id="saveRobots" type="text" placeholder="e.g. index, follow" />
                </div>
                <div class="center-actions" style="margin-top:10px;">
                    <button class="btn" id="stage1Next">Next</button>
                </div>
            </div>
            <div class="save-stage hidden" data-stage="2" id="stage2" aria-hidden="true">
                <div>
                    <!-- <h3 style="margin:0 0 6px 0;">Authorization Required</h3> -->
                    <div class="author-card" aria-hidden="false">
                        <div class="author-photo" aria-hidden="true">
                            <img src="" alt="" style="display:none;" />
                            <span style="font-weight:800; color:#3CFF15;">MJ</span>
                        </div>
                        <div class="author-meta">
                            <div class="name">Muhammad Jibran Zada</div>
                            <div class="bio">Author.</div>
                        </div>
                    </div>
                </div>
                <div class="field-row" style="margin-top:12px;">
                    <label for="authPassword">Password</label>
                    <input id="authPassword" type="password" placeholder="Enter your password" aria-describedby="passwordHelp" />
                    <div id="passwordHelp" class="security-indicator">
                        <i class="fas fa-shield-alt security-icon"></i>
                        <span>Password is securely hashed with SHA-256</span>
                    </div>
                    <div class="error" id="passwordError" style="display:none;">
                        <i class="fas fa-exclamation-triangle"></i> 
                        Incorrect password. Please try again.
                    </div>
                </div>
                <div class="center-actions" style="margin-top:8px;">
                    <button class="btn secondary" id="stage2Back">Back</button>
                    <button class="btn" id="stage2Next">Verify & Continue</button>
                </div>
            </div>
            <div class="save-stage hidden" data-stage="3" id="stage3" aria-hidden="true">
                <div>
                    <!-- <h3 style="margin:0 0 6px 0;">Export Blog</h3> -->
                    <p style="margin: 0 0 10px 0; color: rgba(127,255,165,0.9);">Your blog is ready! Click Download to save it as an HTML file</p>
                    <div class="export-progress" id="exportProgress">
                        <div class="spinner"></div>
                        <span>Generating HTML file...</span>
                    </div>
                </div>
                <div class="center-actions" style="margin-top:auto;">
                    <button class="btn secondary" id="stage3Back">Back</button>
                    <button class="btn" id="stage3Download">Download</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const SECURE_PASSWORD_HASH = 'ad1d0a33d1475e29c577be23e29fdf19e1df3663b7c7ed77272bcf3289f1595e';

// Global variable to store the loaded HTML template
let htmlTemplate = null;

async function loadHTMLTemplate() {
    try {
        const response = await fetch('prototype.html');
        if (!response.ok) {
            throw new Error(`Failed to load prototype.html: ${response.status} ${response.statusText}`);
        }
        htmlTemplate = await response.text();
        console.log('✅ HTML template loaded successfully from prototype.html');
        return htmlTemplate;
    } catch (error) {
        console.error('❌ Error loading HTML template:', error);
        // Fallback to inline template if external file fails
        htmlTemplate = getInlineHTMLTemplate();
        console.log('⚠️ Using fallback inline HTML template');
        return htmlTemplate;
    }
}

// Fallback inline template (same as before, in case external file fails)
function getInlineHTMLTemplate() {
    return `<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatibe" content="IE-edge" >
  <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  <!-- FontAwesome CDN for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<!-- Font Awesome CDN (Working Icons) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Goldman:wght@400;700&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
<link href='https://cdn.boxicons.com/fonts/basic/boxicons.min.css' rel='stylesheet'>
<link href='https://cdn.boxicons.com/fonts/brands/boxicons-brands.min.css' rel='stylesheet'>
    <title>{{BLOG_TITLE}}</title>
    {{META_DESCRIPTION}}
    {{META_KEYWORDS}}
    <meta name="robots" content="{{ROBOTS}}">
    <meta name="author" content="Muhammad Jibran Zada">
    <meta name="generator" content="Secure Blog Editor v1.0">

    <style>
      *{
  margin: 0;
  padding: 0;
  font-family: Quicksand;
  box-sizing: border-box;
  text-decoration: none;
  border: none;
  outline: none;
}
:root{
  --bg-color:black;
  --main-color: #3CFF15 ;
}

        body {
            font-family: 'Quicksand';
            line-height: 1.6;
            color: var(--main-color);
            background-color: var(--bg-color);
            /*max-width: 800px;*/
            width: 70%;
            margin: 0 auto;
            padding: 20px;
        }
html { 
  font-size: 62.5%;
}



header{
  position: fixed;
  top: 0;
  left: 0;
  width:100%;
  padding: 1.5rem 4%;
  background: var(--bg-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
  z-index: 100;
}

.logo{
  font-size: 3.2rem;
  color: var(--main-color);
  font-style: bold;
  font-weight: 700;
}

nav a{
  font-size: 2rem;
  color: var(--main-color);
  font-weight: 700;
  margin-left: 1.5rem;
  transition: 0.3s;
  border: 3px solid transparent;
  border-radius: 30px;
  padding-top: 5px;
  padding-bottom: 5px;
  padding-left: 9px;
  padding-right: 9px;
}

nav a:hover{
  border: 3px solid var(--main-color);
  border-radius: 30px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 9px;
  padding-right: 9px;
}

nav .home{
   border: 3px solid var(--main-color);
  border-radius: 30px;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 9px;
  padding-right: 9px;
}

#menu-icon {
  font-size: 4rem;
  display: none;
}


/*===========================Navbar Animation =========================*/

/* Initial hidden state */
.nav-hidden {
  opacity: 0;
  transform: translateY(-15px);
  transition: opacity 0.2s ease, transform 0.2s ease;
}

/* Reveal animation */
.nav-reveal {
  opacity: 1;
  transform: translateY(0);
}

/* ===================== Mobile Responsive Styles ===================== */
@media (max-width: 768px) {

  /* Show menu icon */
  #menu-icon {
    display: block;
    color: var(--main-color);
    cursor: pointer;
    z-index: 101;
  }

  /* Hide original navbar on mobile */
  header nav {
    display: none;
  }

  /* Fullscreen menu overlay */
  .mobile-nav {
    position: fixed;
    top: 0;
    right: -100%;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.3); /* dark blur background */
    backdrop-filter: blur(10px);
    z-index: 100;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: right 0.4s ease;
  }

  .mobile-nav.active {
    right: 0;
  }

.mobile-nav .mobone{
  font-size: 2.4rem;
  background: var(--main-color);
    color: var(--bg-color);
    margin: 1.5rem 0;
    font-weight: 700;
    transition: 0.3s;
    padding-top: 5px;
  padding-bottom: 5px;
  padding-left: 10px;
  padding-right: 10px;
  border-radius: 20px;
}
  .mobile-nav a {
    font-size: 2.4rem;
    color: var(--main-color);
    margin: 1.5rem 0;
    font-weight: 700;
    transition: 0.3s;
    padding-top: 5px;
  padding-bottom: 5px;
  padding-left: 10px;
  padding-right: 10px;
  border-radius: 20px;
  }

  .mobile-nav a:hover, .mobone {
    background: var(--main-color);
  color: var(--bg-color);
  padding-top: 5px;
  padding-bottom: 5px;
  padding-left: 10px;
  padding-right: 10px;
  border-radius: 20px;
  box-shadow: 0, 0, 1rem var(--main-color);
  }  
}


/*============================= hiding scroll bar line ===================*/
/* Hide scrollbar for all elements */
::-webkit-scrollbar {
  width: 0px;
  height: 0px;
}

/* Optional: remove scrollbar track background */
::-webkit-scrollbar-track {
  background: transparent;
}

/* Optional: remove scrollbar thumb */
::-webkit-scrollbar-thumb {
  background: transparent;
}

/* Hide scrollbar for Firefox */
body {
  scrollbar-width: none; /* Firefox */
  -ms-overflow-style: none;  /* IE and Edge */
}

/* Optional: just in case, remove from html tag too */
html {
  scrollbar-width: none;
}



.blog-content{
            margin-top: 50px;
        }

        .blog-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--main-color);
            margin-bottom: 1rem;
            text-align: center;
            padding-bottom: 0.5rem;
        }

        .blog-heading {
            font-size: 2rem;
            font-weight: bold;
            color: var(--main-color);
            margin: 2rem 0 1rem 0;
        }

        .blog-heading-2 {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--main-color);
            margin: 1.5rem 0 0.8rem 0;
        }

        .blog-heading-3 {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--main-color);
            margin: 1.2rem 0 0.6rem 0;
        }

        .blog-paragraph {
            font-size: 1.1rem;
            margin-bottom: 1.2rem;
            text-align: justify;
        }

        .blog-italic {
            font-size: 1.1rem;
            margin-bottom: 1.2rem;
            text-align: justify;
            color: var(--main-color);
        }

        .blog-link {
            font-size: 1.1rem;
            margin-bottom: 1.2rem;
            font-weight: bold;
        }

        .blog-link a {
            color: var(--main-color);
            cursor: pointer;
            text-decoration: underline;
        }

        .blog-link a:hover {
            color: var(--main-color);
            font-weight: bold;
        }

        .blog-image-container,
        .blog-video-container,
        .blog-iframe-container,
        .blog-audio-container {
            margin: 2rem 0;
            text-align: center;
        }

        .blog-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .blog-video {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .blog-iframe {
            width: 100%;
            height: 400px;
            border-radius: 8px;
        }

        .blog-audio {
            width: 100%;
            max-width: 500px;
        }

        .blog-ordered-list,
        .blog-unordered-list {
            margin: 1.2rem 0;
            padding-left: 2rem;
        }

        .blog-ordered-list li,
        .blog-unordered-list li {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .blog-button-container {
            margin: 2rem 0;
            text-align: center;
        }

        .blog-button {
            display: inline-block;
            padding: 10px 24px;
            background-color: var(--bg-color);
            color: var(--main-color);
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            transition: background-color 0.3s ease;
            border: 2px solid var(--main-color);
            cursor: pointer;
            font-size: 1.1rem;
        }

        .blog-button:hover {
            background-color: var(--main-color);
            color: var(--bg-color);
        }

        .blog-footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid #eee;
            text-align: center;
            color: #666;
            font-style: italic;
        }

        @media (max-width: 600px) {
            body {
                padding: 15px;
            }

            .blog-title {
                font-size: 2rem;
            }

            .blog-heading {
                font-size: 1.6rem;
            }

            .blog-iframe {
                height: 250px;
            }
            blog-content{
            margin-top: 70px;
        }
        }
            
    </style>
</head>
<body>
    <!-- -------------------------------------------header ----------------------------------------->
<header>
  <a href="#" class="logo">Portfolio.</a>
  <i class='bx  bx-menu' id="menu-icon" ></i> 
  <nav>
    <a href="index.html" >Home</a>
    <a href="About.html">About</a>
    <a href="Projects.html">Projects</a>
    <a href="Blogs.html">Blog</a>
    <a href="Contact.html">Contact</a>
  </nav>
</header>


<!-- Mobile Nav (hidden by default) -->
<div class="mobile-nav" id="mobileNav">
  <a href="index.html" >Home</a>
  <a href="About.html" >About</a>
  <a href="Projects.html">Projects</a>
  <a href="Blogs.html">Blog</a>
  <a href="Contact.html">Contact</a>
</div>
    <article class="blog-content">
        {{BLOG_CONTENT}}
    </article>

    <footer class="blog-footer">
        <p>Published by Muhammad Jibran Zada</p>
        <p>Generated on {{CURRENT_DATE}} • Secured with SHA-256</p>
    </footer>
</body>
</html>`;
}

async function generateSHA256Hash(str) {
    try {
        // Convert string to Uint8Array
        const encoder = new TextEncoder();
        const data = encoder.encode(str);
        
        // Generate SHA-256 hash
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        
        // Convert hash to hex string
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(byte => byte.toString(16).padStart(2, '0')).join('');
        
        return hashHex;
    } catch (error) {
        console.error('Error generating SHA-256 hash:', error);
        throw new Error('Failed to generate password hash');
    }
}

async function verifyPassword(inputPassword) {
    try {
        const inputHash = await generateSHA256Hash(inputPassword);
        
        const storedHashArray = new Uint8Array(SECURE_PASSWORD_HASH.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
        const inputHashArray = new Uint8Array(inputHash.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
                    if (storedHashArray.length !== inputHashArray.length) {
            return false;
        }
        let result = 0;
        for (let i = 0; i < storedHashArray.length; i++) {
            result |= storedHashArray[i] ^ inputHashArray[i];
        }
        
        return result === 0;
    } catch (error) {
        console.error('Error verifying password:', error);
        return false;
    }
}

let correctPasswordHashHex = null;

async function initializeSecureHash() {
    try {
        correctPasswordHashHex = await generateSHA256Hash('pakistan');
        console.log('Security system initialized successfully');
    } catch (error) {
        console.error('Failed to initialize security system:', error);
    }
}

// Initialize everything when DOM is ready
document.addEventListener('DOMContentLoaded', async function() {
    await initializeSecureHash();
    await loadHTMLTemplate(); // Load the external HTML template
    console.log('🔒 Secure Blog Editor initialized successfully');
    console.log('🛡️ Password protection: SHA-256 hash verification');
    console.log('✅ All security measures active');
    console.log('🧹 Auto-cleanup system enabled');
});

const plusBtn = document.getElementById('plus-btn');
const popupblog = document.getElementById('popupblog');
const blogSection = document.getElementById('blog-section');
const saveBtn = document.getElementById('save-btn');

const modalOverlay = document.getElementById('modalOverlay');
const modalName = document.getElementById('modalName');
const modalLink = document.getElementById('modalLink');
const modalSave = document.getElementById('modalSave');
const modalCancel = document.getElementById('modalCancel');
const saveModalOverlay = document.getElementById('saveModalOverlay');
const saveModalCancel = document.getElementById('saveModalCancel');
const stage1 = document.getElementById('stage1');
const stage2 = document.getElementById('stage2');
const stage3 = document.getElementById('stage3');
const stage1Next = document.getElementById('stage1Next');
const stage2Back = document.getElementById('stage2Back');
const stage2Next = document.getElementById('stage2Next');
const stage3Back = document.getElementById('stage3Back');
const stage3Download = document.getElementById('stage3Download');
const saveModalTitle = document.getElementById('saveModalTitle');
const passwordInput = document.getElementById('authPassword');
const passwordError = document.getElementById('passwordError');
const saveTitle = document.getElementById('saveTitle');
const saveKeywords = document.getElementById('saveKeywords');
const saveDescription = document.getElementById('saveDescription');
const saveRobots = document.getElementById('saveRobots');
const exportProgress = document.getElementById('exportProgress');
let currentConfigButton = null; // reference to the dynamic button being configured    

// Save button click handler
saveBtn.addEventListener('click', () => {
    openSaveModal();
});

plusBtn.addEventListener('click', () => {
    plusBtn.classList.toggle('rotate');
    popupblog.classList.toggle('show');
});

popupblog.querySelectorAll('button').forEach(button => {
    button.addEventListener('click', () => {
        const type = button.dataset.type;
        const template = document.getElementById(`template-${type}`);
        if (template) {
            const clone = template.content.cloneNode(true);
            attachEvents(clone);
            blogSection.appendChild(clone);
        }
        popupblog.classList.remove('show');
        plusBtn.classList.remove('rotate');
    });
});

function openConfigModal(targetBtn) {
    currentConfigButton = targetBtn;
    modalName.value = targetBtn.dataset.name || "";
    modalLink.value = targetBtn.dataset.url || "";
    modalOverlay.classList.add('show');
    setTimeout(() => { modalName.focus(); }, 60);
}

function closeConfigModal() {
    currentConfigButton = null;
    modalOverlay.classList.remove('show');
    modalName.value = ""; 
    modalLink.value = "";
}

modalCancel.addEventListener('click', () => closeConfigModal());
modalOverlay.addEventListener('click', (e) => {
    if (e.target === modalOverlay) closeConfigModal();
});

modalSave.addEventListener('click', () => {
    if (!currentConfigButton) return closeConfigModal();
    
    const name = modalName.value.trim();
    const url = modalLink.value.trim();
    
    if (name) {
        currentConfigButton.textContent = name;
        currentConfigButton.dataset.name = name;
    } else {
        currentConfigButton.textContent = '+Add';
        delete currentConfigButton.dataset.name;
    }
    
    if (url) {
        let safe = url;
        if (!/^https?:\/\//i.test(safe)) safe = 'https://' + safe;
        currentConfigButton.dataset.url = safe;
        currentConfigButton.dataset.configured = 'true';
    } else {
        delete currentConfigButton.dataset.url;
        currentConfigButton.dataset.configured = 'false';
    }
    closeConfigModal();
});

function openSaveModal() {
    showStage(1);
    passwordInput.value = '';
    passwordError.style.display = 'none';
    exportProgress.classList.remove('show');
    saveModalTitle.textContent = 'Blog Details';
    saveModalOverlay.classList.add('show');
    saveModalOverlay.setAttribute('aria-hidden', 'false');
    setTimeout(() => saveTitle.focus(), 80);
}

function closeSaveModal() {
    saveModalOverlay.classList.remove('show');
    saveModalOverlay.setAttribute('aria-hidden', 'true');
    exportProgress.classList.remove('show');
}

function showStage(n) {
    const stages = [stage1, stage2, stage3];
    stages.forEach((s, idx) => {
        if (idx === (n-1)) {
            s.classList.remove('hidden');
            s.classList.add('active');
            s.setAttribute('aria-hidden', 'false');
        } else {
            s.classList.remove('active');
            s.classList.add('hidden');
            s.setAttribute('aria-hidden', 'true');
        }
    });
    
    if (n === 1) saveModalTitle.textContent = 'Blog Details';
    else if (n === 2) saveModalTitle.textContent = 'Authorization Required';
    else if (n === 3) saveModalTitle.textContent = 'Export Blog';
}

stage1Next.addEventListener('click', () => {
    if (saveTitle.value.trim() === '') {
        saveTitle.focus();
        return;
    }
    showStage(2);
    setTimeout(() => passwordInput.focus(), 80);
});

stage2Back.addEventListener('click', () => {
    showStage(1);
    setTimeout(() => saveTitle.focus(), 80);
});    

stage2Next.addEventListener('click', async () => {
    passwordError.style.display = 'none';
    const enteredPassword = passwordInput.value || '';
    
    // Show loading state
    stage2Next.disabled = true;
    stage2Next.textContent = 'Verifying...';
    
    try {
        await new Promise(resolve => setTimeout(resolve, 500));
        const isPasswordCorrect = await verifyPassword(enteredPassword);
        if (isPasswordCorrect) {
            showStage(3);
            console.log('Authentication successful');
        } else {
            passwordError.style.display = 'block';
            passwordInput.focus();
            console.log('Authentication failed');
        }
    } catch (error) {
        console.error('Authentication error:', error);
        passwordError.textContent = 'Authentication system error. Please try again.';
        passwordError.style.display = 'block';
    } finally {
        stage2Next.disabled = false;
        stage2Next.textContent = 'Verify & Continue';
    }
});

stage3Back.addEventListener('click', () => {
    showStage(2);
    setTimeout(() => passwordInput.focus(), 80);
});

stage3Download.addEventListener('click', async () => {
    exportProgress.classList.add('show');
    stage3Download.disabled = true;
    stage3Download.textContent = 'Generating...';
    
    try {
        await new Promise(resolve => setTimeout(resolve, 800));
        
        const htmlContent = await exportBlogToHTML();
        const blogTitle = saveTitle.value.trim() || 'blog';
        const safeTitle = blogTitle.toLowerCase()
            .replace(/[^a-z0-9]/g, '-')
            .replace(/-+/g, '-')
            .replace(/^-|-$/g, '');
        const timestamp = new Date().toISOString().slice(0,10); // YYYY-MM-DD
        const filename = `${safeTitle}-${timestamp}.html`;
        
        downloadHTML(htmlContent, filename);
        exportProgress.classList.remove('show');
        setTimeout(() => {
            closeSaveModal();
        }, 1000);
    } catch (error) {
        console.error('Export error:', error);
        alert('Error generating HTML file. Please try again.');
    } finally {
        stage3Download.disabled = false;
        stage3Download.textContent = 'Download HTML';
        exportProgress.classList.remove('show');
    }
});

// Save modal close handlers
saveModalCancel.addEventListener('click', closeSaveModal);
saveModalOverlay.addEventListener('click', (e) => {
    if (e.target === saveModalOverlay) closeSaveModal();
});

function placeCaretAtEnd(el) {
    el.focus();
    const range = document.createRange();
    range.selectNodeContents(el);
    range.collapse(false);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
}

function placeCaretAtStart(el) {
    el.focus();
    const range = document.createRange();
    range.selectNodeContents(el);
    range.collapse(true);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function downloadHTML(content, filename) {
    const blob = new Blob([content], { type: 'text/html;charset=utf-8' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(link.href);
}

function attachEvents(block) {
    const deleteBtn = block.querySelector('.delete-btn');
    if (deleteBtn) {
        deleteBtn.addEventListener('click', () => deleteBtn.parentElement.remove());
    }
    const textarea = block.querySelector('textarea');
    if (textarea) {
        textarea.addEventListener('input', () => {
            if (textarea.value.length >= 0) {
                textarea.style.height = 'auto';
                textarea.style.height = `${textarea.scrollHeight}px`;
            }
        });
        setTimeout(() => {
            textarea.style.height = 'auto';
            textarea.style.height = `${textarea.scrollHeight}px`;
        }, 0);
    }
    const uploadAudio = block.querySelector('.upload-audio');
    if (uploadAudio) {
        const audioEl = block.querySelector('audio');
        uploadAudio.addEventListener('click', () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.mp3';
            fileInput.click();
            fileInput.addEventListener('change', e => {
                const file = e.target.files[0];
                if (file) {
                    audioEl.src = URL.createObjectURL(file);
                    uploadAudio.remove();
                }
            });
        });
    }
    const uploadImage = block.querySelector('.upload-image');
    if (uploadImage) {
        uploadImage.addEventListener('click', () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.jpg,.jpeg,.png,.gif';
            fileInput.click();
            fileInput.addEventListener('change', e => {
                const file = e.target.files[0];
                if (file) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    uploadImage.parentElement.appendChild(img);
                    const secondBtn = uploadImage.nextElementSibling;
                    if (secondBtn) secondBtn.remove();
                    uploadImage.remove();
                }
            });
        });
    }
    const linkImage = block.querySelector('.link-image');
    if (linkImage) {
        linkImage.addEventListener('click', () => {
            const url = prompt("Enter image URL:");
            if (url) {
                const img = document.createElement('img');
                img.src = url;
                linkImage.parentElement.appendChild(img);
                const prev = linkImage.previousElementSibling;
                if (prev) prev.remove();
                linkImage.remove();
            }
        });
    }
    const uploadVideo = block.querySelector('.upload-video');
    if (uploadVideo) {
        uploadVideo.addEventListener('click', () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.mp4';
            fileInput.click();
            fileInput.addEventListener('change', e => {
                const file = e.target.files[0];
                if (file) {
                    const vid = document.createElement('video');
                    vid.src = URL.createObjectURL(file);
                    vid.controls = true;
                    uploadVideo.parentElement.appendChild(vid);
                    const secondBtn = uploadVideo.nextElementSibling;
                    if (secondBtn) secondBtn.remove();
                    uploadVideo.remove();
                }
            });
        });
    }
    const linkVideo = block.querySelector('.link-video');
    if (linkVideo) {
        linkVideo.addEventListener('click', () => {
            const url = prompt("Enter video URL:");
            if (url) {
                const embed = url.includes("watch?v=") ? url.replace("watch?v=", "embed/") : url;
                const iframe = document.createElement('iframe');
                iframe.src = embed;
                iframe.width = "100%";
                iframe.height = "400px";
                iframe.frameBorder = "0";
                iframe.allow = "accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture";
                iframe.allowFullscreen = true;
                linkVideo.parentElement.appendChild(iframe);
                const prev = linkVideo.previousElementSibling;
                if (prev) prev.remove();
                linkVideo.remove();
            }
        });
    }
    const dynBtn = block.querySelector('.dynamic-config-btn');
    if (dynBtn) {
        if (!dynBtn.dataset.configured) dynBtn.dataset.configured = 'false';
        
        dynBtn.addEventListener('click', function (e) {
            e.stopPropagation();
            if (this.dataset.configured === 'true' && this.dataset.url) {
                window.open(this.dataset.url, '_blank');
            } else {
                openConfigModal(this);
            }
        });
        dynBtn.addEventListener('dblclick', function (e) {
            e.stopPropagation();
            openConfigModal(this);
        });
    }
    const countBtn = block.querySelector('.count-list-btn');
    const bulletBtn = block.querySelector('.bullet-list-btn');
    const listArea = block.querySelector('.list-area');
    if (countBtn) {
        countBtn.addEventListener('click', () => {
            const controls = countBtn.parentElement;
            if (controls) controls.style.display = 'none';
            
            const ol = document.createElement('ol');
            ol.className = 'editable-list';
            const li = document.createElement('li');
            li.contentEditable = 'true';
            li.spellcheck = false;
            li.innerHTML = '';
            ol.appendChild(li);
            listArea.appendChild(ol);
            placeCaretAtStart(li);
            ol.addEventListener('keydown', function (e) {
                const target = e.target;
                if (target && target.tagName && target.tagName.toLowerCase() === 'li') {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const newLi = document.createElement('li');
                        newLi.contentEditable = 'true';
                        newLi.spellcheck = false;
                        newLi.innerHTML = '';
                        if (target.nextSibling) {
                            target.parentNode.insertBefore(newLi, target.nextSibling);
                        } else {
                            target.parentNode.appendChild(newLi);
                        }
                        placeCaretAtStart(newLi);
                    } else if (e.key === 'Backspace') {
                        if (target.textContent.trim() === '') {
                            e.preventDefault();
                            const prev = target.previousElementSibling;
                            const parent = target.parentNode;
                            target.remove();
                            if (prev) {
                                placeCaretAtEnd(prev);
                            } else {
                                if (!parent.querySelector('li')) {
                                    ol.remove();
                                    if (controls) controls.style.display = '';
                                }
                            }
                        }
                    }
                }
            });
        });
    }
    if (bulletBtn) {
        bulletBtn.addEventListener('click', () => {
            const controls = bulletBtn.parentElement;
            if (controls) controls.style.display = 'none';
            const ul = document.createElement('ul');
            ul.className = 'editable-list';
            const li = document.createElement('li');
            li.contentEditable = 'true';
            li.spellcheck = false;
            li.innerHTML = '';
            ul.appendChild(li);
            listArea.appendChild(ul);
            placeCaretAtStart(li);
            ul.addEventListener('keydown', function (e) {
                const target = e.target;
                if (target && target.tagName && target.tagName.toLowerCase() === 'li') {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const newLi = document.createElement('li');
                        newLi.contentEditable = 'true';
                        newLi.spellcheck = false;
                        newLi.innerHTML = '';
                        if (target.nextSibling) {
                            target.parentNode.insertBefore(newLi, target.nextSibling);
                        } else {
                            target.parentNode.appendChild(newLi);
                        }
                        placeCaretAtStart(newLi);
                    } else if (e.key === 'Backspace') {
                        if (target.textContent.trim() === '') {
                            e.preventDefault();
                            const prev = target.previousElementSibling;
                            const parent = target.parentNode;
                            target.remove();
                            if (prev) {
                                placeCaretAtEnd(prev);
                            } else {
                                if (!parent.querySelector('li')) {
                                    ul.remove();
                                    if (controls) controls.style.display = '';
                                }
                            }
                        }
                    }
                }
            });
        });
    }
}

// Updated export function to use external HTML template
async function exportBlogToHTML() {
    // Ensure template is loaded
    if (!htmlTemplate) {
        await loadHTMLTemplate();
    }
    
    const blogTitle = saveTitle.value.trim() || 'Untitled Blog';
    const keywords = saveKeywords.value.trim();
    const description = saveDescription.value.trim();
    const robots = saveRobots.value.trim() || 'index, follow';
    const contentBlocks = document.querySelectorAll('#blog-section .content-block');
    let blogContent = '';
    
    contentBlocks.forEach((block, index) => {
        if (block.querySelector('.save-btn') || block.querySelector('.plus-btn')) return;
        const textarea = block.querySelector('textarea');
        const img = block.querySelector('img');
        const video = block.querySelector('video');
        const iframe = block.querySelector('iframe');
        const audio = block.querySelector('audio');
        const list = block.querySelector('.editable-list');
        const customBtn = block.querySelector('.dynamic-config-btn');
        
        if (textarea) {
            const content = textarea.value.trim();
            if (!content) return;
            
            const classes = textarea.className;
            
            if (classes.includes('title')) {
                blogContent += `    <h1 class="blog-title">${escapeHtml(content)}</h1>\n`;
            } else if (classes.includes('heading') && !classes.includes('heading-two') && !classes.includes('heading-three')) {
                blogContent += `    <h2 class="blog-heading">${escapeHtml(content)}</h2>\n`;
            } else if (classes.includes('heading-two')) {
                blogContent += `    <h3 class="blog-heading-2">${escapeHtml(content)}</h3>\n`;
            } else if (classes.includes('heading-three')) {
                blogContent += `    <h4 class="blog-heading-3">${escapeHtml(content)}</h4>\n`;
            } else if (classes.includes('paragraph')) {
                blogContent += `    <p class="blog-paragraph">${escapeHtml(content).replace(/\n/g, '<br>')}</p>\n`;
            } else if (classes.includes('link')) {
                const urlPattern = /(https?:\/\/[^\s]+)/g;
                const linkedContent = escapeHtml(content).replace(urlPattern, '<a href="$1" target="_blank" rel="noopener">$1</a>');
                blogContent += `    <div class="blog-link">${linkedContent}</div>\n`;
            } else if (classes.includes('italic-textarea')) {
                blogContent += `    <p class="blog-italic"><em>${escapeHtml(content).replace(/\n/g, '<br>')}</em></p>\n`;
            }
        } else if (img && img.src) {
            const altText = img.alt || 'Blog image';
            blogContent += `    <div class="blog-image-container">\n        <img src="${img.src}" alt="${escapeHtml(altText)}" class="blog-image">\n    </div>\n`;
        } else if (video && video.src) {
            blogContent += `    <div class="blog-video-container">\n        <video controls class="blog-video" src="${video.src}"></video>\n    </div>\n`;
        } else if (iframe && iframe.src) {
            blogContent += `    <div class="blog-iframe-container">\n        <iframe src="${iframe.src}" class="blog-iframe" frameborder="0" allowfullscreen></iframe>\n    </div>\n`;
        } else if (audio && audio.src) {
            blogContent += `    <div class="blog-audio-container">\n        <audio controls class="blog-audio" src="${audio.src}"></audio>\n    </div>\n`;
        } else if (list) {
            const listItems = list.querySelectorAll('li');
            if (listItems.length > 0) {
                const listType = list.tagName.toLowerCase();
                const listClass = listType === 'ol' ? 'blog-ordered-list' : 'blog-unordered-list';
                blogContent += `    <${listType} class="${listClass}">\n`;
                
                listItems.forEach(li => {
                    const itemContent = li.textContent.trim();
                    if (itemContent) {
                        blogContent += `        <li>${escapeHtml(itemContent)}</li>\n`;
                    }
                });
                blogContent += `    </${listType}>\n`;
            }
        } else if (customBtn) {
            const btnName = customBtn.dataset.name || customBtn.textContent.trim();
            const btnUrl = customBtn.dataset.url;
            if (btnName && btnName !== '+Add') {
                if (btnUrl) {
                    blogContent += `    <div class="blog-button-container">\n        <a href="${btnUrl}" target="_blank" rel="noopener" class="blog-button">${escapeHtml(btnName)}</a>\n    </div>\n`;
                } else {
                    blogContent += `    <div class="blog-button-container">\n        <button class="blog-button">${escapeHtml(btnName)}</button>\n    </div>\n`;
                }
            }
        }
    });
    
    // Use the loaded template and replace placeholders
    let finalHTML = htmlTemplate;
    
    // Replace placeholders with actual content
    finalHTML = finalHTML.replace('{{BLOG_TITLE}}', escapeHtml(blogTitle));
    
    // Handle meta description
    if (description) {
        finalHTML = finalHTML.replace('{{META_DESCRIPTION}}', `<meta name="description" content="${escapeHtml(description)}">`);
    } else {
        finalHTML = finalHTML.replace('{{META_DESCRIPTION}}', '');
    }
    
    // Handle meta keywords
    if (keywords) {
        finalHTML = finalHTML.replace('{{META_KEYWORDS}}', `<meta name="keywords" content="${escapeHtml(keywords)}">`);
    } else {
        finalHTML = finalHTML.replace('{{META_KEYWORDS}}', '');
    }
    
    finalHTML = finalHTML.replace('{{ROBOTS}}', escapeHtml(robots));
    finalHTML = finalHTML.replace('{{BLOG_CONTENT}}', blogContent || '    <p class="blog-paragraph">No content available.</p>\n');
    finalHTML = finalHTML.replace('{{CURRENT_DATE}}', new Date().toLocaleDateString());
    
    return finalHTML;
}

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        if (modalOverlay.classList.contains('show')) closeConfigModal();
        if (saveModalOverlay.classList.contains('show')) closeSaveModal();
    }
});

document.addEventListener('click', (e) => {
});

document.querySelectorAll('.save-modal').forEach(el => {
    el.addEventListener('click', e => e.stopPropagation());
});

document.addEventListener('focus', function(event) {
    if (!saveModalOverlay.classList.contains('show')) return;
    const modal = document.querySelector('.save-modal');
    if (!modal.contains(event.target)) {
        event.stopPropagation();
        modal.querySelector('input, textarea, button')?.focus();
    }
}, true);

function clearSaveModalFields() {
    saveTitle.value = '';
    saveKeywords.value = '';
    saveDescription.value = '';
    saveRobots.value = '';
    passwordInput.value = '';
                passwordError.style.display = 'none';
    exportProgress.classList.remove('show');
                stage2Next.disabled = false;
    stage2Next.textContent = 'Verify & Continue';
    stage3Download.disabled = false;
    stage3Download.textContent = 'Download HTML';
    console.log('✨ Save modal fields cleared');
}

function clearConfigModalFields() {
    modalName.value = '';
    modalLink.value = '';
    console.log('✨ Config modal fields cleared');
}

function clearAllFieldsOnLoad() {
    clearSaveModalFields();
    clearConfigModalFields();
    console.log('🔄 All fields cleared on page load');
}    

function closeSaveModalWithCleanup() {
    saveModalOverlay.classList.remove('show');
    saveModalOverlay.setAttribute('aria-hidden', 'true');
    exportProgress.classList.remove('show');
                clearSaveModalFields();
    showStage(1);
}

function closeConfigModalWithCleanup() {
    currentConfigButton = null;
    modalOverlay.classList.remove('show');
    clearConfigModalFields();
}

saveModalCancel.removeEventListener('click', closeSaveModal);
saveModalCancel.addEventListener('click', closeSaveModalWithCleanup);

saveModalOverlay.removeEventListener('click', (e) => {
    if (e.target === saveModalOverlay) closeSaveModal();
});
saveModalOverlay.addEventListener('click', (e) => {
    if (e.target === saveModalOverlay) closeSaveModalWithCleanup();
});

modalCancel.removeEventListener('click', closeConfigModal);
modalCancel.addEventListener('click', closeConfigModalWithCleanup);

modalOverlay.removeEventListener('click', (e) => {
    if (e.target === modalOverlay) closeConfigModal();
});
modalOverlay.addEventListener('click', (e) => {
    if (e.target === modalOverlay) closeConfigModalWithCleanup();
});

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        if (modalOverlay.classList.contains('show')) closeConfigModalWithCleanup();
        if (saveModalOverlay.classList.contains('show')) closeSaveModalWithCleanup();
    }
});

const originalStage3Download = stage3Download.cloneNode(true);
stage3Download.parentNode.replaceChild(originalStage3Download, stage3Download);

document.getElementById('stage3Download').addEventListener('click', async () => {
    exportProgress.classList.add('show');
    document.getElementById('stage3Download').disabled = true;
    document.getElementById('stage3Download').textContent = 'Generating...';
    try {
        await new Promise(resolve => setTimeout(resolve, 800));
        const htmlContent = await exportBlogToHTML(); // Now uses external template
        const blogTitle = saveTitle.value.trim() || 'blog';
        const safeTitle = blogTitle.toLowerCase()
            .replace(/[^a-z0-9]/g, '-')
            .replace(/-+/g, '-')
            .replace(/^-|-$/g, '');
        const timestamp = new Date().toISOString().slice(0,10); // YYYY-MM-DD
        const filename = `${safeTitle}-${timestamp}.html`;
        downloadHTML(htmlContent, filename);
        exportProgress.classList.remove('show');
        setTimeout(() => {
            closeSaveModalWithCleanup(); // Use cleanup version
        }, 1000);
    } catch (error) {
        console.error('Export error:', error);
        alert('Error generating HTML file. Please try again.');
    } finally {
        document.getElementById('stage3Download').disabled = false;
        document.getElementById('stage3Download').textContent = 'Download HTML';
        exportProgress.classList.remove('show');
    }
});

window.addEventListener('beforeunload', () => {
    clearSaveModalFields();
    clearConfigModalFields();
});

document.addEventListener('visibilitychange', () => {
    if (!document.hidden) {
        clearSaveModalFields();
        clearConfigModalFields();
    }
});

window.addEventListener('load', clearAllFieldsOnLoad);
clearAllFieldsOnLoad();
</script>
</body>
</html>